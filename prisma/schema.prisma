generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model categories {
  id_kategori   BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  nama_kategori String    @db.VarChar(255)
  created_at    DateTime? @db.Timestamp(0)
  updated_at    DateTime? @db.Timestamp(0)
  menus         menus[]
}

model menu_menu_option {
  id        BigInt  @id @default(autoincrement()) @db.UnsignedBigInt
  menu_id   BigInt? @db.UnsignedBigInt
  option_id BigInt? @db.UnsignedBigInt

  menus        menus?        @relation(fields: [menu_id], references: [id_menu])
  menu_options menu_options? @relation(fields: [option_id], references: [id_option])

  @@index([menu_id])
  @@index([option_id])
}

model menu_options {
  id_option  BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  nama_opsi  String?   @db.VarChar(255)
  pilihan    String?   @db.LongText
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  menu_menu_option menu_menu_option[]
}

model menus {
  id_menu      BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  category_id  BigInt    @db.UnsignedBigInt
  nama_menu    String    @db.VarChar(255)
  harga        Int       @default(0)
  gambar       String?   @db.VarChar(255)
  created_at   DateTime? @db.Timestamp(0)
  updated_at   DateTime? @db.Timestamp(0)
  is_available Boolean?  @default(true)

  categories          categories            @relation(fields: [category_id], references: [id_kategori])
  menu_menu_option    menu_menu_option[]
  transaction_details transaction_details[]

  @@index([category_id])
}

model transaction_details {
  id_detail      BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  transaction_id BigInt    @db.UnsignedBigInt
  menu_id        BigInt    @db.UnsignedBigInt
  jumlah         Int       @default(1)
  sub_total      Int       @default(0)
  catatan        String?   @db.Text
  created_at     DateTime? @db.Timestamp(0)
  updated_at     DateTime? @db.Timestamp(0)


  menus        menus        @relation(fields: [menu_id], references: [id_menu])
  transactions transactions @relation(fields: [transaction_id], references: [id_transaksi], onDelete: Cascade)

  @@index([menu_id])
  @@index([transaction_id])
}

model transactions {
  id_transaksi BigInt @id @default(autoincrement()) @db.UnsignedBigInt

  order_id     String? @unique @db.VarChar(100)
  email        String? @db.VarChar(255)

  nama_pelanggan String? @db.VarChar(255)

  sumber       transactions_source @default(kasir)
  status       String @default("pending") @db.VarChar(50)

  snap_token   String? @db.VarChar(255)
  total_harga  Int     @default(0)
  metode_pembayaran String? @db.VarChar(255)

  tanggal_transaksi DateTime  @default(now()) @db.Timestamp(0)
  created_at        DateTime  @default(now()) @db.Timestamp(0)
  updated_at        DateTime? @db.Timestamp(0)


  transaction_details transaction_details[]
}


enum transactions_source {
  web
  kasir
}
