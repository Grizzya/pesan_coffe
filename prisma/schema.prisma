generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model categories {
  id_kategori   BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  nama_kategori String    @db.VarChar(255)
  created_at    DateTime? @db.Timestamp(0)
  updated_at    DateTime? @db.Timestamp(0)
  menus         menus[]
}

model menu_menu_option {
  id           BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  menu_id      BigInt?       @db.UnsignedBigInt
  option_id    BigInt?       @db.UnsignedBigInt
  menus        menus?        @relation(fields: [menu_id], references: [id_menu], onDelete: Restrict, onUpdate: Restrict, map: "menu_menu_option_ibfk_1")
  menu_options menu_options? @relation(fields: [option_id], references: [id_option], onDelete: Restrict, onUpdate: Restrict, map: "menu_menu_option_ibfk_2")

  @@index([menu_id], map: "menu_id")
  @@index([option_id], map: "option_id")
}

model menu_options {
  id_option        BigInt             @id @default(autoincrement()) @db.UnsignedBigInt
  nama_opsi        String?            @db.VarChar(255)
  pilihan          String?            @db.LongText
  created_at       DateTime?          @db.Timestamp(0)
  updated_at       DateTime?          @db.Timestamp(0)
  menu_menu_option menu_menu_option[]
}

model menus {
  id_menu             BigInt                @id @default(autoincrement()) @db.UnsignedBigInt
  category_id         BigInt                @db.UnsignedBigInt
  nama_menu           String                @db.VarChar(255)
  harga               Int                   @default(0)
  gambar              String?               @db.VarChar(255)
  created_at          DateTime?             @db.Timestamp(0)
  updated_at          DateTime?             @db.Timestamp(0)
  is_available        Boolean?              @default(true)
  menu_menu_option    menu_menu_option[]
  categories          categories            @relation(fields: [category_id], references: [id_kategori], map: "menus_category_fk")
  transaction_details transaction_details[]

  @@index([category_id], map: "category_id")
}

model transaction_details {
  id_detail      BigInt       @id @default(autoincrement()) @db.UnsignedBigInt
  transaction_id BigInt       @db.UnsignedBigInt
  menu_id        BigInt       @db.UnsignedBigInt
  jumlah         Int          @default(1)
  sub_total      Int          @default(0)
  created_at     DateTime?    @db.Timestamp(0)
  updated_at     DateTime?    @db.Timestamp(0)
  menus          menus        @relation(fields: [menu_id], references: [id_menu], map: "td_menu_fk")
  transactions   transactions @relation(fields: [transaction_id], references: [id_transaksi], onDelete: Cascade, map: "td_transaction_fk")

  @@index([menu_id], map: "menu_id")
  @@index([transaction_id], map: "transaction_id")
}

model transactions {
  id_transaksi        BigInt @id @default(autoincrement()) @db.UnsignedBigInt
  order_id            String? @unique @db.VarChar(100)   // âœ… TAMBAH @unique
  user_id             BigInt? @db.UnsignedBigInt
  nama_pelanggan      String? @db.VarChar(255)
  email               String? @db.VarChar(255)
  total_harga         Int     @default(0)
  metode_pembayaran   String? @db.VarChar(255)
  tanggal_transaksi   DateTime? @default(now()) @db.Timestamp(0)
  created_at          DateTime? @db.Timestamp(0)
  updated_at          DateTime? @db.Timestamp(0)
  source              transactions_source @default(kasir)
  transaction_details transaction_details[]
  users               users? @relation(fields: [user_id], references: [id], map: "transactions_user_fk")

  @@index([user_id], map: "user_id")
}


model users {
  id                BigInt         @id @default(autoincrement()) @db.UnsignedBigInt
  name              String         @db.VarChar(255)
  email             String         @unique(map: "users_email_unique") @db.VarChar(255)
  email_verified_at DateTime?      @db.Timestamp(0)
  password          String         @db.VarChar(255)
  remember_token    String?        @db.VarChar(100)
  created_at        DateTime?      @db.Timestamp(0)
  updated_at        DateTime?      @db.Timestamp(0)
  role              String?        @db.VarChar(255)
  transactions      transactions[]
}

enum transactions_source {
  web
  kasir
}
